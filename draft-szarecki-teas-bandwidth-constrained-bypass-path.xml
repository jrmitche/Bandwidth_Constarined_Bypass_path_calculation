<?xml version="1.0" encoding="utf-8"?>
<!-- 
     draft-rfcxml-general-template-standard-00
  
     This template includes examples of the most commonly used features of RFCXML with comments 
     explaining how to customise them. This template can be quickly turned into an I-D by editing 
     the examples provided. Look for [REPLACE], [REPLACE/DELETE], [CHECK] and edit accordingly.
     Note - 'DELETE' means delete the element or attribute, not just the contents.
     
     Documentation is at https://authors.ietf.org/en/templates-and-schemas
-->
<?xml-model href="rfc7991bis.rnc"?>  <!-- Required for schema validation and schema-aware editing -->
<!-- <?xml-stylesheet type="text/xsl" href="rfc2629.xslt" ?> -->
<!-- This third-party XSLT can be enabled for direct transformations in XML processors, including most browsers -->


<!DOCTYPE rfc [
  <!ENTITY nbsp    "&#160;">
  <!ENTITY zwsp   "&#8203;">
  <!ENTITY nbhy   "&#8209;">
  <!ENTITY wj     "&#8288;">
]>
<!-- If further character entities are required then they should be added to the DOCTYPE above.
     Use of an external entity file is not recommended. -->

<rfc
  xmlns:xi="http://www.w3.org/2001/XInclude"
  category="info"
  docName="draft-szarecki-teas-bandwidth-constrained-bypass-path"
  ipr="trust200902"
  obsoletes=""
  updates=""
  submissionType="IETF"
  xml:lang="en"
  version="3">
<!-- [REPLACE] 
       * docName with name of your draft
     [CHECK] 
       * category should be one of std, bcp, info, exp, historic
       * ipr should be one of trust200902, noModificationTrust200902, noDerivativesTrust200902, pre5378Trust200902
       * updates can be an RFC number as NNNN
       * obsoletes can be an RFC number as NNNN 
-->

  <front>
    <title abbrev="bandwidth-constrained-only FRR">MPLS FRR bypass path calculation with automatically derived bandwdth constrain and its signalling with different bandwidth to be reserved</title>
    <!--  [REPLACE/DELETE] abbrev. The abbreviated title is required if the full title is longer than 39 characters -->

    <seriesInfo name="Internet-Draft" value="draft-szarecki-teas-bandwidth-constrained-bypass-path"/>
   
    <author fullname="Rafal Jan Szarecki" initials="R.J." surname="Szarecki">
      
    <!-- all of the following elements are optional -->
      <organization>Google LLC</organization>
      <address>
        <postal>
          <!-- Reorder these if your country does things differently -->
          <street>1600 Amphitheatre Parkway</street>
          <city>Mountain View</city>
          <region>California</region>
          <code>94043</code>
          <country>US</country>
          <!-- Uses two letter country code -->
        </postal>        
        <phone></phone>
        <email>rszarecki@gmail.com</email>
      </address>
    </author>
    <author fullname="Jon Mitchell" initials="J." surname="Mitchell">
      <organization>Google LLC</organization>
      <address>
        <postal>
          <!-- Reorder these if your country does things differently -->
          <street>1600 Amphitheatre Parkway</street>
          <city>Mountain View</city>
          <region>California</region>
          <code>94043</code>
          <country>US</country>
          <!-- Uses two letter country code -->
        </postal>        
        <phone></phone>
        <email>jrmitche@puck.nether.net</email>
      </address>
    </author>

    <date year="2024"/>
    <!-- On draft subbmission:
         * If only the current year is specified, the current day and month will be used.
         * If the month and year are both specified and are the current ones, the current day will
           be used
         * If the year is not the current one, it is necessary to specify at least a month and day="1" will be used.
    -->

    <area>Routing</area>
    <workgroup>Traffic Engineering Architecture and Signaling</workgroup>
    <!-- "Internet Engineering Task Force" is fine for individual submissions.  If this element is 
          not present, the default is "Network Working Group", which is used by the RFC Editor as 
          a nod to the history of the RFC Series. -->

    <keyword>MPLS</keyword>
    <keyword>FRR</keyword>
    <keyword>bypass</keyword>
    <keyword>facility backup</keyword>
    <keyword>local protection</keyword>
    <keyword>bandwidth reservation</keyword>
    <keyword>CSPF</keyword>
    <!-- [REPLACE/DELETE]. Multiple allowed.  Keywords are incorporated into HTML output files for 
         use by search engines. -->

    <abstract>
      <t>The <xref target="RFC4090"/> documents facility backup in MPLS networks - the local protection technology, that use bypass tunnel LSP.This specification describes methods that allows Point of Local Repair (PLR) to find path with sufficient available bandwidth to accommodate protected traffic, while do not make undesired reservation hence making the solution econamically feasible. Below aspects are covered:</t>
      <ul spacing="normal">
        <li>Automatic determination of bypass required bandwidth with reasonable accuracy by PLR</li>
        <li>Calculation of path (ERO)</li>
        <li>Determination of RSVP SENDER-TSPEC rate value for bypass tunnel signaling</li>
      </ul>
    </abstract>
 
  </front>

  <middle>
    
    <section>
     <name>Introduction</name>
      <t>Network operators use MPLS-TE technology to optimize network resources (bandwidth over network graph) while providing prioritized treatment - high bandwidth and low loss. This is often done by combination of bandwidth reservation for LSPs and protection (of some more critical) of them by facility backup <xref target="RFC4090"/> technique.
      The facility backup uses a bypass tunnel (instantiated as MPLS LSP) to temporally carry impacted LSP around a faulted resource (link, node), immediately after failure. The bypass tunnel's path is computed and established before failure as result of what-if-like analysis, for every possible failure. Hence there are much more established bypasses in the network, or even originating on particular node  (PLR), then foreseen to be used at any given point of time.
      Typically, a bypass tunnel is established without any bandwidth reservation, and routed on the shortest path between PLR and Merging Point (MP) after pruning topology out of protected resource (link, interface) and others that share the same SRLGs. This is understandable, because making bandwidth reservation for bypass tunnels would result in "consumption" of network capacity for all bypasses while only very few of it is used at the same time, and for a very short period  - just a few minutes after failure. Furthemore, in order to make reservation for bypasses possible, network links need to be built with sufficient capacity, which make this option economically unfeasible.
      This practice however has limitations - bypass tunnel could be routed over interfaces that available bandwidth lower than protected traffic volume. This limitation is specifically common in networks that are built with reduced latency and capacity cost as critical design goals. Such a network has a very large spread between highest and lowest capacity of adjacencies and metrics bound to latency/distance rather than capacity.</t>
      <t>This document provides procedures that routing node - PLR - can utilize to optimize bypass tunnel path computation, so it is routed over links in a network that has sufficient available bandwidth, while not compromising network economics. Procedures described are local to PLR, hence do not impose any special requirements on other nodes in the network, and could be deployed incrementally. Furthermore implementations of this procedures across vendors and software releases may vary, and still can be deployed simultaneously in a common network.</t>
      
      <section>
        <name>Requirements Language</name>
        <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL",
          "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT
          RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be
          interpreted as described in BCP 14 <xref target="RFC2119"/>
          <xref target="RFC8174"/> when, and only when, they appear in
          all capitals, as shown here.</t>
      </section>
      <!-- [CHECK] The 'Requirements Language' section is optional -->

    </section>
    
    <section anchor="P-Bw_determination">
      <name>Finding of bypass required bandwidth</name>
        <t>In order to allow PLR to perform bypass path computation that has sufficient available bandwidth, the volume of traffic protected by a given bypass tunnel needs to be determined. For the purpose of this document we will reference this as PROTECTED-BANDWIDTH or P-Bw.</t>
        <section>
          <name>Static PROTECTED-BANDWIDTH</name>
          <t>The protected bandwidth for could be computed by offline tool and configured on PLR either on per bypass tunnel basis or as template for multiple bypasses, globally or on per protected resource basis. Obviously accuracy of this method, specifically when used with templates, is limited. The exact procedure how offline tool calculated PROTECTED-BANDWIDTH is out of scope of this document.</t>
        </section>
        <section>
          <name>Periodically computed PROTECTED-BANDWIDTH</name>
          <t>It is assumed that the local system - PLR - is aware of all bandwidth reserved by LPS, as well as the bypass tunnel entity protecting each of LSP. Therefore, PLR can compute total protected bandwidth per bypass tunnel, and can do it on regular intervals (P-Bw-timer). By configuring P-Bw-rimer, the operator has great control on CPU resources consumed by this calculation. The periodically computed PROTECTED-BANDWIDTH method requires some in-memory state storage - P-BW - that will be used for next bypass tunnel path computation. After calculating protected bandwidth at timer expiration it is to be stored in PROTECTED-BANDWIDTH. Implementation can apply some logic to prevent negligible changes or large changes such as minimum percentage change vs. previous value and/or weighted average among previous and recently calculated values.</t>
          <t>The periodic computation interval is expected to be shorter or equal to optimization timer LSPs implementing bypass tunnel.</t>
        </section>
        <section>
          <name>Just-in-time computed PROTECTED-BANDWIDTH</name>
          <t>It is assumed that the local system - PLR - is aware of all bandwidth reserved by LPS, as well as the bypass tunnel entity protecting each LSP. Therefore, PLR can compute total protected bandwidth per bypass tunnel, and do this when the Bypass tunnel path needs to be computed (see below) - just-in-time. This method prevents unnecessary computations if the bypass-tunnel is stable, but can cause multiple consecutive computations if bypass tunnel path computation is triggered by external events rapidly in a short period of time.</t>
          <t>The just-in-time computed PROTECTED-BANDWIDTH method does not require in-memory state storage - PROTECTED-BANDWIDTH could be ephemeral and not needed after path computation. However, storing recently calculated PROTECTED-BANDWIDTH in memory, allows to apply similar "smoothing" logic as in a periodically computed method, at time of next calculation. It is the implementation's decision to preserve PROTECTED-BANDWIDTH until the next computation.</t>
        </section>
        <section>
          <name>Initial PROTECTED-BANDWIDTH value</name>
          <t>For methods in which PLR computes P-Bw autonomously, special consideration need to be given for case when new interface become operational and LSP existon on the network start gradually moving onto it, as result of their reoptimization intervals. Initially there will be just very few LSP (or just one) LSP that requires protection, hence Bypass creation is triggered for very little bandwidth. Although periodical as well as just-in-time P-Bw computation would eventually follow and adjust to capacity carried over protected LSPs, this may take quite a long time (see <xref target="bypass-path-comp"/>). Implementation should allow for configuration of minimum PROTECTED-BANDWIDTH (minP-Bw), used for bypass path computation in case P-Bw derived in above procedures is lower than minP-Bw.</t>
        </section>

      <!-- <t>Other mathods of determination of protected bandwidth are possible, and could be used.</t> -->
    </section>
    <section anchor="bypass-path-comp">
      <name>Bypass path computation</name>
      <t>The network path for the bypass tunnel is computed using the same logic as foreseen in <xref target="RFC4090"/>. There are four classes of events that triggers computation of bypass path:</t>
      <ol>
        <li>Expiration of existing bypass lsp reoptimization timer</li>
        <li>Recipients of PathErr due to network failure along existing bypass path or failure of existing bypass egress interface on PLR</li>
        <li>Initialization of new bypass </li>
        <li anchor="LSP-resignalling">change of reserved bandwidth of protected LSP or signaling of ne LSP that is to be protected by existing bypass tunnel.</li>
      </ol>
      <t>The last event (<xref target="LSP-resignalling"/>) can occur quite frequently, especially in networks that utilize automatic bandwidth determination for LSP with aggressive intervals. As such, authors believed that these events SHOULD NOT trigger bypass path computation. This is because including these events would lead to never converging network and adversely impact computational resources - control plane CPU of network device.</t>
      <t>For the events of first three classes, the PROTECTED-BANDWIDTH determined as per <xref target="P-Bw_determination"/> should be used to derive path computation bandwidth constraints - CSPF-BANDWIDTH (CSPF-Bw). Implementation should allow the application of a scaling factor in range from 0% to at least 200% of PROTECTED-BANDWIDTH to derive CSPF-BANDWIDTH, and default value should be 100%. This scaling factor allows network operators to increase protection capacity safety with values greater than 100%. At same time use of factor lower than 100% allows network operators to allow bypass lsp on routes that more likely creates congestion, and intentionally accept some level of traffic loss (e.g. low priority, best-effort).</t>
      <t>The CSPF-BANDWIDTH value is feeded to the path computation process (typically CSPF) and usually, together with other attributes (e.g. SRLG). The result of this process is an ordered list of network interfaces in the form of Explicit Route Object (ERO) for bypass tunnel, that is used for signaling of LSP instantiating bypass tunnel.</t>
    </section>
    <section>
      <name>Bypass tunnel signaling</name>
      <t>Bypass tunnels are instantiated as LSP that have head-end on PLR and tail-end on MP. They are signaled to RSVP just like any other MPLS LSP. Specifically PLR uses and inserts ERO objects into PATH messages to enforce network path given bypass traverses. The other important RSVP PATH's object is Traffic-Specification (T-SPEC), which encodes bandwidth that needs to be reserved for signaled LSP.</t>
      <t>Under this procedure, T-SPEC bandwidth MUST not be equal to CSPF-BANDWIDTH or PROTECTED-BANDWIDTH. Instead LSP bandwidth shall be either statically configured (typically very small) value (e.g. 0bps, 200kbps) or derived from CSPF-Bw by applying signaling bandwidth scaling factor of value form range 0% to 100%. Implementation SHOULD support static configuration of signaled bandwidth, and can support use of signaling bandwidth scaling factor.</t>
      <t>PLR MUST insert The ERO object in RSVP PATH, and its value MUST be the ERO computed as per <xref target="bypass-path-comp"/>.</t>
      <t>Note: If ERO returned by path computation (<xref target="bypass-path-comp"/>) is equal to network path bypass tunnel currently travers, and signaled bandwidth did not changed (e.g. because has static configured value), there is no need for signaling new LSP - existing one could be refreshed and keep used.</t>
      <section>
        <name>Benefits of non-zero bypass signaled bandwidth</name>
        <t>There are certain benefits of using non-zero bypass signaled, hence reserved, bandwidth:</t>
        <ul>
          <li>Bypass with non-zero reservation is subject to (soft-)preemption in case of deep capacity shortage. Network operators may want to prioritize optimal routing of LSPs that carry traffic all the time, over bypasses that carry traffic only in case of failure and only for a brief period of time.</li>
          <li>Bypass with non-zero reservation contributes to the last-fill algorithm. With low bandwidth value it would not be a primary contributor, but can become important in preventing all bypasses concentrating on a single link, and promote spray it over ECMP path more fairly.</li>
        </ul>
        <t>On the other hand, however, bandwidth reserved for bypass can't be used by other lSPs. It's a wasted capacity cost. It is up to network operator to decide how much of wasted capacity are worth above benefits.</t>
        <t></t>
      </section>
    </section>

    <section anchor="IANA">
    <!-- All drafts are required to have an IANA considerations section. See RFC 8126 for a guide.-->
      <name>IANA Considerations</name>
      <t>This memo includes no request to IANA.</t>
    </section>
    
    <section anchor="Security">
      <!-- All drafts are required to have a security considerations section. See RFC 3552 for a guide. -->
      <name>Security Considerations</name>
      <t>This document should not affect the security of the Internet.</t>
    </section>
    
    <!-- NOTE: The Acknowledgements and Contributors sections are at the end of this template -->
  </middle>

  <back>
    <references>
      <name>References</name>
      <references>
        <name>Normative References</name>
        
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.4090.xml"/>
        <!-- The recommended and simplest way to include a well known reference -->
        
      </references>
 
      <references>
        <name>Informative References</name>
       
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.8174.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.2702.xml"/>  
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.3209.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.3630.xml"/>  
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.5305.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.8733.xml"/>           
       
      </references>
    </references>

    <section anchor="Acknowledgements" numbered="false">
      <name>Acknowledgements</name>
      <t>TBD</t>
    </section>
    
    <section anchor="Contributors" numbered="false">
      <!-- [REPLACE/DELETE] a Contributors section is optional -->
      <name>Contributors</name>
      <t>TBD</t>
    </section>
    
 </back>
</rfc>